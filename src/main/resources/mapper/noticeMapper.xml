<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.fastcampus.toy2_7.dao.NoticeMapper">
    <sql id="noticeForm">
        select noticeID, noticeTitle,noticeContent,priority,status,regId, regDate, modId, modDate, displayFlag
        from notice
    </sql>


    <!--전체 컬럼 수-->
    <select id="count" resultType="int">
        select count(*) from Notice
    </select>


    <select id="selectOne" parameterType="int" resultType="NoticeDto">
        -- noticeID 값과 동일한 필드 1개 검색
        <include refid="noticeForm"/>
        where noticeID = #{noticeID}
    </select>

    <!--관리자 전용 전체 게시물 select-->
    <select id="selectAll" resultType="NoticeDto">
        <include refid="noticeForm"/>
        ORDER BY priority desc, regDate desc;
    </select>

    <!-- 관리자가 아닌 사람만 볼 수 있는 게시물 목록 select-->
    <!-- displayFlag =='y'인 게시물만 볼 수 있음 -->
    <select id="selectVisible" resultType="NoticeDto">
        <include refid="noticeForm"/>
        where displayFlag = 'y'
        ORDER BY priority desc, regDate desc;
    </select>


    <delete id="deleteAll">
        -- 전체 필드 삭제
        DELETE from notice;
    </delete>

    <delete id="deleteById" parameterType="int">
        -- 특정 필드 1개 삭제
        DELETE from notice where noticeID = #{noticeID};
    </delete>

    <delete id="deleteByIds" parameterType="list">
        -- 특정 필드 n개 삭제
        DELETE from notice
        where noticeID in
        <foreach item="item" collection="list" open="(" separator="," close=")">
            #{item}
        </foreach> ;
    </delete>

    <insert id="insert" parameterType="NoticeDto">
        -- 필드 삽입
        insert into notice (noticeID,noticeTitle, noticeContent,regId,regDate)
        values
            (#{noticeID}, #{noticeTitle},#{noticeContent},#{regId},#{regDate});
    </insert>

    <!-- AI=AutoIncrement -->
    <insert id="insertAI" parameterType="NoticeDto">
        -- 필드 삽입
        insert into notice (noticeTitle, noticeContent,regId,regDate,displayFlag)
        values
            ( #{noticeTitle},#{noticeContent},#{regId},now(),#{displayFlag});
    </insert>

    <update id="update" parameterType="NoticeDto">
        -- 필드 수정
        update notice
        set
            noticeTitle = #{noticeTitle},
            noticeContent = #{noticeContent},
            modDate = now(),
            displayFlag = #{displayFlag}
        where noticeID = #{noticeID};
    </update>

    <!--모든 게시물 'n'으로 초기화-->
    <update id="setDisplayFlgsN">
        Update notice
        set displayFlag = 'n';
    </update>

    <!-- 선택된 게시물의 displayFlag를 'y'로 설정 -->
    <update id="setDisplayFlags" parameterType="list">
        UPDATE notice
        SET displayFlag = 'y'
        WHERE noticeID IN
        <foreach item="id" index="index" collection="list" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

    <!-- 페이징처리 -->
    <select id="selectPage" parameterType="map" resultType="NoticeDto">
        <include refid="noticeForm"/>
        ORDER BY noticeID desc, regDate desc
        LIMIT #{offset}, #{pageSize};
    </select>

</mapper>